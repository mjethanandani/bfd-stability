<?xml version="1.0" encoding="US-ASCII"?>
<?rfc toc="yes"?>
<?rfc symrefs="yes" ?>
<?rfc sortrefs="yes" ?>
<?rfc tocompact="yes"?>
<?rfc tocdepth="3"?>
<?rfc tocindent="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<rfc
    category="exp"
    docName="draft-ietf-bfd-stability-latest"
    ipr="trust200902"
    consensus="true"
    submissionType="IETF">
  <front>
    <title abbrev="BFD Stability">BFD Stability</title>
    <author fullname="Ashesh Mishra" initials="A" surname="Mishra">
      <organization>Aalyria Technologies</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <phone/>
        <email>ashesh@aalyria.com</email>
        <uri/>
      </address>
    </author>

    <author fullname="Mahesh Jethanandani"
	    initials="M"
	    surname="Jethanandani">
      <organization>Arrcus, Inc.</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country>USA</country>
        </postal>
        <phone/>
        <facsimile/>
        <email>mjethanandani@gmail.com</email>
      </address>
    </author>

    <author fullname="Ankur Saxena" initials="A" surname="Saxena">
      <organization>Ciena Corporation</organization>
      <address>
        <postal>
          <street>3939 North 1st Street</street>
          <city>San Jose</city>
          <region>CA</region>
          <code>95134</code>
          <country>USA</country>
        </postal>
        <phone/>
        <facsimile/>
        <email>ankurpsaxena@gmail.com</email>
        <uri>www.ciena.com</uri>
      </address>
    </author>

    <author fullname="Santosh Pallagatti" initials="S" surname="Pallagatti">
      <organization>VMware</organization>
      <address>
        <postal>
          <street/>
          <city>Bangalore</city>
          <region>Karnataka</region>
          <code>560103</code>
          <country>India</country>
        </postal>
        <phone/>
        <facsimile/>
        <email>santosh.pallagatti@gmail.com</email>
        <uri/>
      </address>
    </author>

    <author fullname="Mach Chen" initials="M" surname="Chen">
      <organization>Huawei</organization>
      <address>
        <postal>
          <street/>
          <city/>
          <region/>
          <code/>
          <country/>
        </postal>
        <phone/>
        <facsimile/>
        <email>mach.chen@huawei.com</email>
        <uri/>
      </address>
    </author>
    <date/>

    <abstract>
      <t>
	This document describes extensions to the Bidirectional
	Forwarding Detection (BFD) protocol to measure BFD
	stability. Specifically, it describes a mechanism for
	the detection of BFD packet loss.</t>
    </abstract>
  </front>

  <middle>
    <section title="Introduction">
      <t>The Bidirectional Forwarding Detection (<xref
      target="RFC5880">BFD)</xref> protocol operates by transmitting and
      receiving BFD control packets, generally at high frequency, over the
      datapath being monitored. In order to prevent significant data loss due
      to a datapath failure, BFD session detection time as defined in <xref
      target="RFC5880">BFD</xref> is set to the smallest feasible value.</t>

      <t>
	A <xref target="RFC5880">BFD</xref> session will remain in the
	Up state as long as it receives at least one packet within the
	Detection Time interval. However, additional packet loss
	within that time interval is not noted by the BFD state
	machinery. Noting the other missed packets provides a valuable
	indicator of systemic issues or a deteriorating network that
	may warrant preventive action.
      </t>
      <t>
	This document proposes an experimental mechanism to detect
	lost packets in a BFD session in addition to the datapath
	fault detection mechanisms of BFD.  Such a mechanism, combined
	with 'received-packet-count' defined in the <xref
	target="RFC9314">YANG Data Model for Bidrectional Forward
	Detection (BFD)</xref> permits operators to measure the
	stability of BFD sessions. The details of the motivation for
	experimental status can be found in <xref
	target="experimental-status"/>. Implementations may also do
	additional analysis of the packet loss over a time
	interval. Such an analysis is outside the scope of this
	document.
      </t>

      <t>
	This document does not propose any BFD extension to measure
	data traffic loss or delay on a link or tunnel, and the scope
	is limited to BFD packets.
      </t>

      <section title="Note to the RFC Editor">
	<t>
	  This document uses several placeholder values throughout the
	  document. Please replace them as follows and remove this
	  section before publication.
	</t>
        <t>
	  RFC XXXX, where XXXX is the number assigned to this document
	  at the time of publication.
	</t>
        <t>
	  YYYY-MM-DD with the actual date of the publication of this
	  document.
	</t>
      </section>
    </section>

    <section title="Terminology">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in <xref
      target="RFC2119">RFC 2119</xref> and <xref target="RFC8174">RFC
      8174</xref>.</t>

      <t>
	The reader is expected to be familiar with the <xref
	target="RFC5880">BFD</xref>.
      </t>
    </section>

    <section title="Use Cases">
      <t>
	Bidirectional Forwarding Detection, as defined in <xref
	target="RFC5880">BFD</xref> cannot detect any BFD packet loss
	if the loss does not last for the Detection Time. This
	document proposes a method to detect dropped packet on the
	receiver. For example, if the receiver receives BFD control
	packet k at time t but receives packet k+3 at time t+10ms, and
	never receives packet k+1 and/or k+2, then it has experienced
	a packet loss.
      </t>

      <t>This proposal enables BFD implementations to generate diagnostic
      information on the health of each BFD session that could be used to
      preempt a failure on a datapath that BFD was monitoring by allowing time
      for a corrective action to be taken.</t>

      <t>
	In a faulty datapath scenario, an operator can use BFD health
	information to trigger the delay and loss measurement OAM
	protocol <xref target="Y-1731">Connectivity Fault Management
	(CFM)</xref> or <xref target="RFC6374">Packet Loss and Delay
	Measurement for MPLS Networks</xref> to further isolate the
	issue.
      </t>
    </section>

    <section title="Functionality">
      <t>
	The functionality proposed for BFD stability measurement is
	achieved by configuring the 'stability' flag in the attached
	YANG model in conjunction with any BFD Meticulous Authentication.
      </t>
    </section>

    <section anchor="null-auth-type" title="NULL Auth Type">
      <t>
	The NULL Authentication Type, defined in this document, can be
	used to provide a meticulously increasing sequence number for
	stability measurement.  It provides none of the protections
	desired for authentication and is used only to provide BFD
	stability services to BFD sessions that otherwise have no
	authentication in use.</t>

      <t>If the Authentication Present (A) bit is set in the header, and the
      Authentication Type field contains TBD, the Authentication section has the
      following format:
      <figure
          align="center" title="NULL Auth Type">
        <artwork><![CDATA[
       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Auth Type   |   Auth Len    |  Auth Key ID  |   Reserved    |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                        Sequence Number                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      ]]></artwork>
      </figure>
      where:
      </t>

      <t>
	Auth Type: The Authentication Type, which in this case is TBD
	(NULL, to be assigned by IANA, with a suggested value of 6).
      </t>

      <t>Auth Len: The length of the NULL Auth Type, in bytes; i.e., 8 bytes</t>

      <t>
	Auth Key ID: The authentication key ID in use for this
	packet. MUST be set to zero and ignored on receipt.
      </t>

      <t>Reserved: This byte MUST be set to zero on transmit and ignored on
      receipt.</t>

      <t>Sequence Number: The sequence number for this packet.  This value is
      incremented for each successive packet transmitted for a session.
      Implementations will use sequence numbers (bfd.XmitAuthSeq) as defined in
      <xref target="RFC5880">BFD</xref>.</t>

      <t>If bfd.AuthSeqKnown is 0, bfd.AuthSeqKnown is set to 1, and
      bfd.RcvAuthSeq is set to the value of the received Sequence Number
      field.</t>

      <t>If bfd.AuthSeqKnown is 1, and the received Sequence Number field is not
      equal to bfd.RcvAuthSeq + 1 (in a circular number space), then the loss
      count is incremented by one and bfd.RcvAuthSeq is set to the received
      Sequence Number.</t>

      <t>Unlike other authentication mechanisms defined for BFD that provide an
      Auth Key/Digest field, when bfd.AuthSeqKnown is 1, the received Sequence
      Number MUST NOT be compared vs. bfd.RcvAuthSeq for purposes of discarding
      the BFD packets.</t>
    </section>

    <section title="Theory of Operation">
      <t>
	This mechanism allows operators to measure the loss of BFD
	control packets.
      </t>

      <t>
	When using MD5 or SHA authentication, BFD MUST use an
	authentication type (bfd.AuthType) that is of type meticulous.
	Other authentication types that provide for meticulously increasing
	sequence numbers can also be used.  This includes the NULL
	authentication mechanism defined in this document or 
	<xref target="I-D.ietf-bfd-secure-sequence-numbers">Meticulous Keyed
	ISAAC for BFD Authentication</xref>.
      </t>

      <section title="Loss Measurement">
        <t>
	  Loss measurement counts the number of BFD control packets
	  missed at the receiver during any Detection Time period. The
	  loss is detected by comparing the Sequence Number field in
	  successive BFD control packets. The Sequence Number in each
	  successive control packet generated on a BFD session by the
	  transmitter is incremented by one. This loss count can then
	  be exposed using the YANG module defined in the subsequent
	  section. See discussion on <xref
	  target="out-of-order-packets">Out of Order Packets</xref>
	  later in the document.
	</t>

        <t>
	  The first BFD authentication section with a non-zero
	  sequence number, in a valid BFD control packet, processed by
	  the receiver, is used for bootstrapping the logic.
	</t>
      </section>

      <section anchor="out-of-order-packets" title="Out of Order Packets">
        <t>
	  Some transmission mechanisms - for example, Link Aggregate Groups
	  (LAG), or Equal Cost Multipath (ECMP) - can result in out of order
	  packet delivery.  In circumstances where BFD packets are not lost, but
	  are delivered out of order, strict comparison of increasing sequence
	  numbers may result in classifying the out of order packets as packet
	  loss.
	</t>
	<t>
	  Implementations MAY provide mechanisms wherein all expected
	  packets received across an expected interval, but delivered
	  out of order are not considered lost packets.
	</t>
      </section>
    </section>

    <section anchor="yang-module" title="Stability YANG Module">
      <section anchor="data-model-overview" title="Data Model Overview">
        <t>
	  This YANG module augments the "ietf-bfd" module to add a
	  flag 'stability' to enable this feature. The feature
	  statement 'stability' needs to be enabled to indicate that
	  BFD Stability is supported by the implementation. In
	  addition, a loss count per-session or lsp for BFD packets
	  that are lost has also been added in this model.
	</t>

        <t>
	  <figure>
            <artwork><![CDATA[
INSERT_TEXT_FROM_FILE(../bin/ietf-bfd-stability@YYYY-MM-DD-tree.txt,69)
]]>
	    </artwork>
          </figure>
	</t>
      </section>

      <section title="YANG Module">
        <t>
	  This YANG module imports <xref target="RFC6991">Common YANG
	  Types</xref>, <xref target="RFC8349">A YANG Data Model for
	  Routing</xref>, and <xref target="RFC9314">YANG Data Model
	  for Bidirectional Forwading Detection (BFD)</xref>.
	</t>

        <t>
	  <figure>
            <artwork><![CDATA[
	    <CODE BEGINS> file "ietf-bfd-stability@YYYY-MM-DD.yang"
	    INSERT_TEXT_FROM_FILE(../bin/ietf-bfd-stability@YYYY-MM-DD.yang,69)
	    <CODE ENDS>
	    ]]>
	    </artwork>
          </figure>
	</t>
      </section>
    </section>

    <section title="IANA Considerations">
      <t>This document requests one new authentication type and
      registers one URIs in the "ns" subregistry of the "IETF XML"
      registry <xref target="RFC3688"/>.</t>

      <section anchor="auth-type" title="Auth Type">
	<t>
	  This document requests an update to the registry titled "BFD
	  Authentication Types". IANA is requested to assign a new
	  BFD AuthType:
	  <ul>
	    <li>
	      NULL Auth Type, with a suggested value of 6.
	    </li>
	  </ul>
	</t>
      </section>
      <section anchor="ietf-xml-registry" title="IETF XML Registry">
	<t>Following the format in <xref target="RFC3688"/>, the following
	registrations are requested:</t>
	<t>
	  <figure>
	    <artwork><![CDATA[URI: urn:ietf:params:xml:ns:yang:ietf-bfd-stability
Registrant Contact: The IESG
XML: N/A, the requested URI is an XML namespace.
]]>
	    </artwork>
	  </figure>
	</t>
      </section>

      <section title="The &quot;YANG Module Names&quot; Registry">
        <t>This document registers one YANG modules in the "YANG Module Names"
        registry <xref target="RFC6020"/>. Following the format in <xref
        target="RFC6020"/>, the following registrations are requested:</t>

        <t><figure>
            <artwork><![CDATA[
name:         ietf-bfd-stability
namespace:    urn:ietf:params:xml:ns:yang:ietf-bfd-stability
prefix:       bfds
reference:    RFC XXXX
]]></artwork>
          </figure></t>
      </section>
    </section>

    <section title="Security Considerations">
      <section title="BFD NULL Auth Security Considerations">
	<t>
	  The use of a BFD authentication mechanism that protects the
	  BFD packets is RECOMMENDED.
	</t>

        <t>
	  The Security Considerations of <xref target="RFC5880"/> for
	  unauthenticated BFD all apply to the new NULL authentication
	  type.  The NULL Authentication type, defined in this
	  document, provides none of the properties desired for
	  authenticating BFD packets.  It is intended to provide BFD
	  sessions that otherwise would not use authentication, a
	  sequence number that can be used for purposes of detecting
	  lost packets.
	</t>

	<t>
	  The lack of a computed AuthKey/Digest over the BFD packet,
	  but the presence of a Sequence Number makes this
	  authentication type susceptible to injection attacks.  BFD
	  without authentication is vulnerable to session resets; the
	  NULL Auth type does not change this.</t>

	<t>
	  When the NULL Authentication type is used for BFD Stability
	  purposes, maliciously injected packets that do not reset the
	  BFD session can resemble high packet loss. Sessions such as
	  multi-hop routed paths, tunnels without authentication, or
	  MPLS LSP, therefore, have security guarantees that are
	  identical to situations where BFD is run without
	  authentication.
	</t>
      </section>
      <section title="YANG Security Considerations">
	<t>
	  The YANG module specified in this document defines a schema
	  for data that is designed to be accessed via network
	  management protocols such as <xref
	  target="RFC6241">NETCONF</xref> or <xref
	  target="RFC8040">RESTCONF</xref>. These YANG-based
	  management protocols have to use a secure transport layer
	  (e.g., <xref target="RFC4252">SSH</xref>, <xref
	  target="RFC8446">TLS</xref>, and <xref
	  target="RFC9000">QUIC</xref>) and have to use mutual
	  authentication.
	</t>
	<t>
	  The <xref target="RFC8341">NETCONF Access Control Model
	  (NACM)</xref> provides the means to restrict access for
	  particular NETCONF or RESTCONF users to a preconfigured
	  subset of all available NETCONF or RESTCONF protocol
	  operations and content.
	</t>

	<t>
	  The YANG module does not define any
	  writeable/creatable/deletable data nodes that can have an
	  adverse impact on a BFD session.
	</t>

	<t>
	  The only readable data nodes in YANG module may be considered
	  sensitive or vulnerable in some network environments. It is
	  thus important to control read access (e.g., via get,
	  get-config, or notification) to these data nodes.
	</t>

	<t>
	  The model defines a read-only node to indicate the number of
	  packets that were lost. Access to this information may allow
	  a malicious user information on which links are experiencing
	  issues. In addition, and as stated in <xref
	  target="out-of-order-packets">Out of Order Packets</xref>,
	  on links such as LAG or ECMP, there is a possibility of
	  packets being delivered out of order. A strict comparison of
	  increasing sequence numbers may result in classifying those
	  out of order packets as packet loss.
	</t>

	<t>The YANG module does not define any RPC operations.</t>
      </section>
    </section>


    <section title="Contributors">
      <t>
	The authors of this document would like to acknowledge Jeff
	Haas as a contributor to this document. His contribution lead
	to a significant improvement of the document. In addition,
	Manav Bhatia contributed to this document.
      </t>
    </section>

    <section title="Acknowledgements">
      <t>
	Authors would like to thank Nobo Akiya, Dileep Singh, Basil
	Saji, Sagar Soni, Albert Fu, Peng Fang, and Mallik Mudigonda
	who contributed to this document. Thanks to Christian Huitema
	for the SECDIR and Ebben Aries for the YANG Doctors review.
      </t>
      <t>
	Thanks to Reshad Rehman for being the shepherd of the
	document.
      </t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include='reference.RFC.2119.xml'?>

      <?rfc include='reference.RFC.3688.xml'?>

      <?rfc include='reference.RFC.4252.xml'?>

      <?rfc include='reference.RFC.5880.xml'?>

      <?rfc include='reference.RFC.6020.xml'?>

      <?rfc include='reference.RFC.6241.xml'?>

      <?rfc include='reference.RFC.6991.xml'?>

      <?rfc include='reference.RFC.8040.xml'?>

      <?rfc include='reference.RFC.8174.xml'?>

      <?rfc include='reference.RFC.8341.xml'?>

      <?rfc include='reference.RFC.8349.xml'?>

      <?rfc include='reference.RFC.8446.xml'?>

      <?rfc include='reference.RFC.9000.xml'?>

      <?rfc include='reference.RFC.9314.xml'?>
    </references>
    <references title="Informative References">
      <?rfc include='reference.RFC.6374.xml'?>
      <?rfc include='reference.I-D.ietf-bfd-secure-sequence-numbers.xml'?>
      <reference anchor="Y-1731">
        <front>
          <title>
	    OAM Functions and Mechanisms for Ethernet-based Networks
	  </title>
          <author>
            <organization>ITU-T</organization>
          </author>
	  <date month="November" year="2013"/>
	</front>
	<seriesInfo name="Recommendation" value="G.8013/Y.1731"/>
      </reference>

    </references>
    <section anchor="experimental-status" title="Experimental Status">
      <t>
	This document describes an experiment that will present a
	candidate solution to predict whether a given <xref
	target="RFC5880">BFD</xref> session will continue to be
	stable. The experiment will use the packet lost count and the
	'received-packet-count' defined in the <xref
	target="RFC9314">YANG Data Model for Bidrectional Forward
	Detection (BFD)</xref> to determine how stable is the
	session. The reason why this document is on an
	Experimental track is because there are no known
	implementations or proof-of-concept. As a result, the authors
	are not clear whether a simple lost count is enough to predict
	the stability or there will be a need to have a more granular
	count.
      </t>
      <t>
	This document is classified as Experimental and is not part of
	the IETF Standards Track.
      </t>
    </section>
    <section anchor="examples" title="Examples">
      <t>
	This section tries to show some examples in how the model can
	be configured for stability.
      </t>
      <section anchor="example-a.1.1" title="Single Hop BFD Configuration">
	<t>
          This example demonstrates how a Single Hop BFD session can
          be configured to enable monitoring of a session for
          stability.
	</t>
	<t>
          <figure>
            <artwork><![CDATA[
            INSERT_TEXT_FROM_FILE(../src/yang/example-bfd-stability-a.1.1.xml,68)
            ]]>
            </artwork>
          </figure>
	</t>
      </section>
            <section anchor="example-a.1.2" title="Use of NULL Auth">
	<t>
          This example demonstrates how to configure NULL Auth
          to enable monitoring of a session for stability.
	</t>
	<t>
          <figure>
            <artwork><![CDATA[
            INSERT_TEXT_FROM_FILE(../src/yang/example-bfd-stability-a.1.2.xml,68)
            ]]>
            </artwork>
          </figure>
	</t>
      </section>
    </section>
  </back>
</rfc>
